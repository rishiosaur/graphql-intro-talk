import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { github } from "@code-surfer/themes";
import Code from "mdx-code";
import { Notes } from "mdx-deck";
import MonkeyLikesBanana from "./MLB.png";
import DontHaveBanana from "./DHB.png";
import ROTTENMAP from "./ROTTENMAP.png";
import HTTP from "./HTTPDIAGRAM.png";
import A from "./ANALYSIS.png";
import GRAPHQL from "./GRAPHQL.png";
import GA from "./GQLANALYSIS.png";

export const theme = {
  fonts: {
    body: '"Kollektif", system-ui, sans-serif',
    heading: '"Helvetica Neue", sans-serif',
    monospace: "Fira Code,Jetbrains Mono, monospace",
  },
  colors: {
    text: "#FFF",
    background: "#000",
    primary: "#e3116c",
  },
  styles: {
    CodeSurfer: {
      tokens: {
        "comment prolog doctype cdata": {
          color: "#999988",
          fontStyle: "italic",
        },
        namespace: {
          opacity: 0.7,
        },
        "string attr-value": {
          color: "#e3116c",
        },
        "punctuation operator": {
          color: "#FFF",
        },
        "entity url symbol number boolean variable constant property regex inserted": {
          color: "#36acaa",
        },
        "atrule keyword attr-name selector": {
          color: "#00a4db",
        },
        "function deleted tag": {
          color: "#d73a49",
        },
        "function-variable": {
          color: "#6f42c1",
        },
        "tag selector": {
          color: "#00009f",
        },
      },
      title: {
        backgroundColor: "#000",
        color: "#FFF",
      },
      subtitle: {
        color: "#000",
        backgroundColor: "#fff",
      },
      pre: {
        color: "#FFF",
        backgroundColor: "#000",
      },
      code: {
        color: "#FFF",
        backgroundColor: "#000",
      },
    },
  },
};

export const pres = {
  fonts: {
    body: '"Helvetica Neue", system-ui, sans-serif',
    heading: '"Helvetica Neue", sans-serif',
    monospace: "'Helvetica Neue'",
  },
  colors: {
    text: "#FFF",
    background: "#000",
    primary: "#e3116c",
  },
  styles: {
    CodeSurfer: {
      tokens: {
        "comment prolog doctype cdata": {
          color: "#999988",
          fontStyle: "italic",
        },
        namespace: {
          opacity: 0.7,
        },
        "string attr-value": {
          color: "#e3116c",
        },
        "punctuation operator": {
          color: "#FFF",
        },
        "entity url symbol number boolean variable constant property regex inserted": {
          color: "#36acaa",
        },
        "atrule keyword attr-name selector": {
          color: "#00a4db",
        },
        "function deleted tag": {
          color: "#d73a49",
        },
        "function-variable": {
          color: "#6f42c1",
        },
        "tag selector": {
          color: "#00009f",
        },
      },
      title: {
        backgroundColor: "#000",
        color: "#FFF",
        fontSize: "150%",
      },
      subtitle: {
        color: "#000",
        backgroundColor: "#fff",
      },
      pre: {
        color: "#FFF",
        backgroundColor: "#000",
      },
      code: {
        color: "#FFF",
        backgroundColor: "#000",
        fontFamily: "system-ui",
        lineHeight: 1.6,
      },
    },
  },
};

export const Highlight = (props) => (
  <span
    style={{
      background: "rgb(255,0,106)",
      background:
        "linear-gradient(63deg, rgba(255,0,106,1) 0%, rgba(110,106,175,1) 46%, rgba(0,230,255,1) 100%)",
      padding: "0.5em",
      display: "inline-block",
    }}
  >
    {props.children}
  </span>
);

<h1>
  {" "}
  Intro to <Highlight>
    <span>GraphQL</span>
  </Highlight> ðŸ•¸
</h1>

---

<CodeSurfer theme={pres}>

```js title="Who am I?"
// rishi.ts
export const name = "Rishi Kothari ðŸ‘‹ðŸ‘¨â€ðŸ’»";
```

```js title="Who am I?"
// rishi.ts
export const name = "Rishi Kothari ðŸ‘‹ðŸ‘¨â€ðŸ’»";
export const location = "ðŸ“šðŸ“ Brampton";
export const age = 15;
```

```js title="Who am I?"
// rishi.ts
export const name = "Rishi Kothari ðŸ‘‹ðŸ‘¨â€ðŸ’»";
export const location = "ðŸ“šðŸ“ Brampton";
export const age = 15;
export const getLoves = [
  "Formula One",
  "Typescript",
  "Open Source",
  "GraphQL",
].sort(() => 0.5 - Math.random())[0];
```

```js title="Who am I?"
// rishi.ts
export const name = "Rishi Kothari ðŸ‘‹ðŸ‘¨â€ðŸ’»";
export const location = "ðŸ“šðŸ“ Brampton";
export const age = 15;
export const getLoves = [
  "Formula One",
  "Typescript",
  "Open Source",
  "GraphQL",
].sort(() => 0.5 - Math.random())[0];
export const socials = {
  most: "@rishiosaur",
  web: "rishi.cx",
};
```

</CodeSurfer>

---

<Highlight>
  <h1>Timeline</h1>
</Highlight>

---

## Introduction [15 minutes]

- What is GraphQL?

- You as a 5-year-old.

- Why use it?

---

## Using the GraphQL SDL [30 minutes]

- General Format
- Queries & Mutations
- Typing

- Introspection & what APIs look like

---

## Building our API [30 - 45ish minutes]

- Asking ourselves questions
- Resolver architecture

- Implementing with Type-GraphQL + Apollo Server

---

## Introduction

<Highlight>
  <h1>
    What <i>is</i> GraphQL?
  </h1>
</Highlight>

---

# A new paradigm for data fetching.

- The better REST
- Define what data you want to grab from the API
- Have type-safe guarantees for your data
- High-level constructs

---

# Monkey!

---

<img src={MonkeyLikesBanana} />

---

<img src={DontHaveBanana} />

---

<img src={ROTTENMAP} />

---

<img src={HTTP} />

---

<img src={A} />

---

<img src={GRAPHQL} />

---

<img src={GA} />

---

# REST

- Individually fetch endpoints
- Client-side validation (no banana checking)
- Lots of useless runs

# GraphQL

- Round-trip fetching
- On-the-fly type validation (rotten bananas) & customization
- Less overall trips; less room to go wrong

---

# GraphQL SDL (Schema Design Language)

# Server Specification

---

# SDL

- GraphQL Language
- Queries, Mutations, and everything in between with
- Defines types for an API, and all the possible things you can do with it

---

<CodeSurfer theme={theme}>

```graphql title="Describe your data"
type Todo {
  id: ID
  title: String
  completed: Boolean
  user: User
}

type TodosPage {
  data: [Todo]
  links: PaginationLinks
  meta: PageMetadata
}

type Query {
  todos(options: PageQueryOptions): TodosPage
  todo(id: ID!): Todo
}
```

```graphql title="Ask for what you need"
query Query {
  todos {
    data {
      id
      title
    }
  }
}
```

```graphql title="Types: Almost like structs!"
type Todo {
  id: ID
  title: String
  completed: Boolean
  user: User
}
```

</CodeSurfer>

---

# Queries vs Mutations

- Equivalent of REST request types

- `Query` = GET request

- `Mutation` = POST request

---

# Server Specification

- A specification made by the GQL consortium to serve up GraphQL APIs
- What you implement to make a GraphQL
- Defines how GraphQL is parsed & queries resolved

---

# Why use GraphQL?

---

<CodeSurferColumns themes={[theme, github]}>

<Step>

```js
fetch(`https://api.spacex.land/rest/capsules-upcoming`)
  .then((resp) => resp.json())
  .then(console.log);
```

```js
const fetchSpaceX = fetch(
  `https://api.spacex.land/graphql`,
  {
    body: JSON.stringify({
      query: `
        {
  capsulesUpcoming {
    status
    id
    type
  }
}
      `,
    }),
  }
)
  .then((resp) => resp.json())
  .then(console.log);
```

</Step>

<Step>

```js
const urls = ["capsules-upcoming", "capsules", "cores"];

Promise.all(
  urls.map((id) =>
    fetch(
      `https://api.spacex.land/rest/${id}`
    ).then((resp) => resp.json())
  )
).then(console.log);
```

```js
const fetchSpaceX = fetch(
  `https://api.spacex.land/graphql`,
  {
    body: JSON.stringify({
      query: `
        {
  capsulesUpcoming {
    status
    id
    type
  }

  capsules { 
    status
    id
    type
  }

  cores {
    status
    id
    types
  }
}
      `,
    }),
  }
)
  .then((resp) => resp.json())
  .then(console.log);
```

</Step>

</CodeSurferColumns>

---

## Using the GraphQL SDL

<Highlight>
  <h1>Introspection</h1>
</Highlight>

---

# g.rishi.cx

---

# Introspection?

---

# What do you want?

- GraphQL's value prop. comes from the fact that you need to specify what you want to do
- Introspection is great for when you're unsure of what you want to do

---

# Interactions

- Query or Mutation?
- Types needed

---

# Creating the Query

- You should have g.rishi.cx open right now

---

<CodeSurfer theme={theme}>

```graphql title="Layout of the query"
query Todos {

}
```

```graphql title="Add types we need"
query Todos {
  todos {

  }
}
```

```graphql title="Add data"
query Todos {
  todos {
    data {

    }
  }
}
```

```graphql title="Final layer of introspection"
query Todos {
  todos {
    data {
      id
    }
  }
}
```

```graphql title="Query done!" 1:7
query Todos {
  todos {
    data {
      id
    }
  }
}
```

```graphql title="Add in posts"
query Todos {
  todos {
    data {
      id
    }
  }

  posts {
    data {
      id
    }
  }
}
```

```graphql title="Add in titles"
query Todos {
  todos {
    data {
      id
      title
    }
  }

  posts {
    data {
      id
      title
    }
  }
}
```

```graphql title="Adding inputs"
query Todos {
  todos(options: {}) {
    data {
      id
      title
    }
  }
}
```

```graphql title="Add options"
query Todos {
  todos(options: { paginate: { limit: 5 } }) {
    data {
      id
      title
    }
  }
}
```

```graphql title="Finish pagination"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      id
      title
    }
  }
}
```

```graphql title="Add ID"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      id
      title
    }
  }

  todo(id: "5") {
    id
    title
  }
}
```

```graphql title="Building a Fragment"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      id
      title
    }
  }

  todo(id: "5") {
    id
    title
  }
}

fragment FTodo on Todo {
  id
  title
}
```

```graphql title="Replacing with Fragments"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      ...FTodo
    }
  }

  todo(id: "5") {
    ...FTodo
  }
}

fragment FTodo on Todo {
  id
  title
}
```

</CodeSurfer>

---

# Recap

- What GraphQL consists of
- What the SDL looks like
- Queries and Mutations
- GraphQL Playground
- Introspection technique
- Wrote our own!

---

# Questions?

---

# Building a GraphQL API

---

# What do we want this to do?

The big question of GraphQL, yet again.

---

# Todos!

- CRU API
- 2 `Query`: Get all

- 2 Update `Mutation`s; Toggling & Complete updates

- 1 Create `Mutation`s; Create a todo!

---

## Demo

`<LINK>`

---

## Architecture

---

<CodeSurfer theme={theme}>

```graphql title="Complex query"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      ...FTodo
    }
  }

  todo(id: "5") {
    ...FTodo
  }
}

fragment FTodo on Todo {
  id
  title
}
```

```graphql title="Desugaring"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) {
    data {
      id
      title
    }
  }

  todo(id: "5") {
    id
    title
  }
}
```

```graphql title="Identify Scalar types"
query Todos {
  todos(options: { paginate: { limit: 5, page: 3 } }) { // TYPE
    data { // TYPE
      id // SCALAR
      title // SCALAR
    }
  }

  todo(id: "5") { // TYPE
    id // SCALAR
    title // SCALAR
  }
}
```

</CodeSurfer>

---

# It's time to build.

Let's put your knowledge to the test!

<!-- 
<CodeSurfer theme={theme}>

```bash
$ git clone https://github.com/rishiosaur/gql.git
$ cd gql
$ yarn
$ yarn start
```

</CodeSurfer>

---

# What we'll be building

todos.rishi.cx

---

# Components of a GraphQL Server

- Server-side SDL

- Resolvers

---

<CodeSurfer theme={theme}>

```graphql title="Resolvers"
query Query {
  todos {
    data {
      id
      title
    }
  }
}
```

</CodeSurfer>

---

# What do we want this API to do?

- CRD todos
- One `Query`
- Two `Mutations`

---

# Types

- `Query`
- `Mutation`
- `Todo`

---

<CodeSurfer theme={theme}>

```graphql title="Resolvers"
type Query {
  todos(): [Todo]
}

type Mutation {
  createTodo(id:ID!, title:String!): Todo
  deleteTodo(id:ID!): Boolean!
}
```

</CodeSurfer>

---

`IMPLEMENT` -->
